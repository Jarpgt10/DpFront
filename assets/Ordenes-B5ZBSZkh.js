import{r as a,af as S,P as U,j as e,ae as o,A as D,F as v,B as Q,ag as B,S as C,f as O,ah as K,ai as V}from"./index-Pir85B3o.js";import{I as _,s as p}from"./index-D5rG4INt.js";import{T as z,R as I,M as $}from"./Table-1Qv6xstB.js";function H(){const{handleItemQuantity:n,isItemAdded:c,carrito:f,totalCarrito:u}=a.useContext(S),{menu:d}=a.useContext(U),[x,m]=a.useState(""),[t,h]=a.useState(1),l=5,N=(t-1)*l,b=N+l,j=d.filter(i=>i.nombre_menu.toLowerCase().includes(x.toLowerCase())||i.precio.toLowerCase().includes(x.toLowerCase())),y=j==null?void 0:j.slice(N,b);return e.jsxs("div",{children:[e.jsx("strong",{className:"text-gray-600 text-xl block mb-2",children:"Menú"}),e.jsx(_,{type:"text",placeholder:"Buscar por nombre de menú",className:"mb-4 border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200",onChange:i=>m(i.target.value)}),e.jsx(z,{dataSource:y,rowKey:"id_menu_comida",columns:[{title:"No.",dataIndex:"id_menu_comida",key:"id_menu_comida"},{title:"Menu",dataIndex:"nombre_menu",key:"nombre_menu"},{title:"Precio",dataIndex:"precio",key:"precio"},{title:"Opcion",render:i=>e.jsxs("div",{className:"flex gap-5",children:[e.jsx("button",{className:"hover:bg-gray-800 rounded-full hover:text-white",onClick:()=>n(i.id_menu_comida,"add",d),children:e.jsx(o.add,{size:25})}),c(i.id_menu_comida)&&e.jsx("button",{className:"hover:bg-gray-800 rounded-full hover:text-white",onClick:()=>n(i.id_menu_comida,"delete",d),children:e.jsx(o.delete,{size:25})})]})}],pagination:{onChange:i=>h(i),pageSize:l,current:t,total:(d==null?void 0:d.length)||0}})]})}function J({data:n,onClose:c}){const{session:f}=a.useContext(D),{carrito:u,totalCarrito:d}=a.useContext(S),x=a.useRef();x.current&&!n&&x.current.resetFields(),a.useEffect(()=>{const t={titular:n?n.titular:"",comer_aqui:n?parseInt(n.comer_aqui):"",direccion:n?n.direccion:""};x.current.setFieldsValue(t)},[n]);const m=async t=>{const h={...t,carrito:u,total:d,direccion:t.direccion?t.direccion:"",id_orden:n&&n.id_orden?n.id_orden:0,id_usuario:f.id_usuario};await B(h).then(l=>{l.err?p.error(l.message):p.success(l.message)}).finally(()=>c())};return e.jsx("div",{className:"mt-5 p-5 bg-white rounded-lg shadow-lg h-[675px] overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-6",children:[e.jsx(H,{}),e.jsx("div",{children:e.jsxs(v,{layout:"vertical",ref:x,onFinish:m,children:[e.jsx(v.Item,{label:e.jsx("strong",{className:"text-gray-600 text-base block mb-2",children:"Nombre"}),name:"titular",rules:[{required:!0,message:"Ingrese Nombre"}],children:e.jsx(_,{className:"border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200"})}),e.jsx(v.Item,{name:"comer_aqui",rules:[{required:!0,message:"ingrese Opcion"}],children:e.jsxs(I.Group,{className:"flex-center gap-5 mb-4",children:[e.jsx(I,{value:1,children:e.jsx(o.store,{size:30})}),e.jsx(I,{value:0,children:e.jsx(o.truck,{size:30})})]})}),e.jsx(v.Item,{label:e.jsx("strong",{className:"text-gray-600 text-base block mb-2",children:"Dirección"}),name:"direccion",children:e.jsx(_.TextArea,{className:"border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200"})}),e.jsx("strong",{className:"text-gray-400",children:"Seleccionado"}),u.length>0&&e.jsxs("div",{className:"mt-5 p-4 border border-gray-200 rounded-lg shadow-sm bg-gray-50",children:[u.map(t=>e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("strong",{children:t.nombre_menu}),e.jsxs("span",{className:"bg-[#1f2937] text-white py-1 px-2 rounded-md ",children:["x",t.cantidad]})]}),e.jsxs("span",{children:["GTQ ",t.precio*t.cantidad]})]},t.id_menu_comida)),e.jsx("div",{className:"flex justify-end mt-3 bg-gray-100 p-2 rounded-md",children:e.jsxs("strong",{children:["Total: GTQ ",d]})})]}),e.jsx("div",{className:"flex-end mt-2",children:e.jsx(Q,{className:"button-submit",type:"default",htmlType:"submit",children:"Guardar"})})]})})]})})}function Z(){const{loading:n,orden:c,setCarrito:f,getAll:u,calculateTotal:d}=a.useContext(S),[x,m]=a.useState(!1),[t,h]=a.useState(null),[l,N]=a.useState(1),b=5,j=(l-1)*b,y=j+b,[i,P]=a.useState(""),[k,M]=a.useState(null),E=s=>{P(s.target.value)},T=s=>{M(s)},w=c&&c.filter(s=>s.titular.toLowerCase().includes(i.toLowerCase())&&(k===null||parseInt(s.estado)===k)),F=w==null?void 0:w.slice(j,y),q=()=>{h(null),m(!1),f([]),d(0)},A=async()=>{m(!1),h(null),await u()},G=s=>{f(s.detalle_orden),d(s.detalle_orden),h(s),m(!0)},L=(s,r)=>{K(s,r).then(g=>{g.err?p.error(g.message):p.success(g.message)}).finally(()=>u())},R=(s,r)=>{V(s,r).then(g=>{g.err?p.error(g.message):p.success(g.message)}).finally(()=>u())};return e.jsxs("div",{className:"h-screen px-[5%] py-[5%]",children:[e.jsx("div",{className:"title-1 flex-between",children:e.jsx("span",{children:"ORDENES"})}),e.jsxs("div",{className:"flex-between",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex-center gap-5",children:[e.jsx(o.reload,{size:25,onClick:()=>u(),className:"cursor-pointer"}),e.jsx(_.Search,{onChange:E}),e.jsxs(C,{placeholder:"Filtrar por estado",onChange:T,allowClear:!0,style:{width:200},children:[e.jsx(C.Option,{value:null,children:"Todos"}),e.jsx(C.Option,{value:0,children:"Preparando"}),e.jsx(C.Option,{value:1,children:"Entregado"})]}),e.jsx("button",{onClick:()=>m(!0),children:e.jsx(o.add,{size:25,color:"white",className:"bg-[#1f2937] bg-hover-3 rounded-full"})})]}),e.jsx("div",{})]}),e.jsx(z,{className:"mt-5",dataSource:F,loading:n,rowKey:"id_orden",columns:[{title:"Orden",width:100,render:(s,r)=>e.jsx("div",{className:"bg-4 p-1 mx-auto text-xl text-1 rounded-lg flex-center items-center",children:e.jsx("strong",{children:r.id_orden})}),sorter:(s,r)=>s.id_orden-r.id_orden},{title:"Nombre",width:250,render:(s,r)=>e.jsx("div",{className:"",children:e.jsx("strong",{children:r.titular})})},{title:"Para",render:(s,r)=>e.jsx("div",{className:"",children:e.jsx("strong",{children:parseInt(r.comer_aqui)===1?e.jsx(o.store,{size:30}):e.jsx(o.truck,{size:30})})})},{title:"Fecha",dataIndex:"fecha_ingreso",key:"fecha_ingreso",sorter:(s,r)=>O(s.fecha_ingreso).unix()-O(r.fecha_ingreso).unix()},{title:"Total",render:(s,r)=>e.jsxs("div",{className:"",children:["GTQ ",e.jsx("strong",{children:r.total})]})},{title:"Estado",render:(s,r)=>e.jsx("div",{className:"",children:e.jsx("strong",{className:`${parseInt(r.estado)===1?"bg-green-700 ":"bg-orange-400"} text-white p-1 rounded-md hover:border-2 border-[#00000059] cursor-pointer`,onClick:()=>R(r.id_orden,parseInt(r.estado)===1?0:1),children:parseInt(r.estado)===1?"Entregado":"Preparando"})})},{title:"Pagado",render:(s,r)=>e.jsx("div",{className:"",children:e.jsx("strong",{className:`${parseInt(r.pagado)===1?"text-green-700":"text-red-800"} `,children:e.jsx("div",{className:"cursor-pointer",onClick:()=>L(r.id_orden,parseInt(r.pagado)===1?0:1),children:parseInt(r.pagado)===1?e.jsx(o.check,{size:25}):e.jsx(o.cancel,{size:25})})})})},{title:"Editar",render:(s,r)=>e.jsx("strong",{className:"cursor-pointer",onClick:()=>G(r),children:e.jsx(o.edit,{className:"hover:text-gray-500 ",size:20})})}],pagination:{onChange:s=>N(s),pageSize:b,current:l,total:(c==null?void 0:c.length)||0}}),e.jsx($,{open:x,footer:null,onCancel:()=>q(),title:e.jsxs("div",{children:[t?"Editar":"Crear"," Orden "]}),width:1200,centered:!0,children:e.jsx(J,{data:t,onClose:()=>A()})})]})}export{Z as default};
