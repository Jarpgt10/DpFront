import{r as a,A as U,ac as T,P as D,j as e,ab as n,F as I,B as Q,ad as B,S,ae as M,af as K,ag as $}from"./index-BzgqDStd.js";import{I as k,s as g}from"./index-DVJZcIxl.js";import{T as F,R as E,M as V}from"./Table-t5M6nHr8.js";function H({data:d,onClose:l}){const{session:N}=a.useContext(U),{handleItemQuantity:o,isItemAdded:v,carrito:j,totalCarrito:c}=a.useContext(T),{menu:i}=a.useContext(D),[x,_]=a.useState(""),[y,p]=a.useState(1),m=5,C=(y-1)*m,O=C+m,w=a.useRef();a.useEffect(()=>{w.current.resetFields()},[d]);const h=i.filter(t=>t.nombre_menu.toLowerCase().includes(x.toLowerCase())||t.precio.toLowerCase().includes(x.toLowerCase())),z=h==null?void 0:h.slice(C,O),P=async t=>{const b={...t,carrito:j,total:c,direccion:t.direccion?t.direccion:"",id_orden:d&&d.id_orden?d.id_orden:0,id_usuario:N.id_usuario};await B(b).then(f=>{f.err?g.error(f.message):g.success(f.message)}).finally(()=>l())};return e.jsx("div",{className:"mt-5 p-5 bg-white rounded-lg shadow-lg h-[675px] overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"text-gray-600 text-xl block mb-2",children:"Menú"}),e.jsx(k,{type:"text",placeholder:"Buscar por nombre de menú",className:"mb-4 border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200",onChange:t=>_(t.target.value)}),e.jsx(F,{dataSource:z,rowKey:"id_menu_comida",columns:[{title:"No.",dataIndex:"id_menu_comida",key:"id_menu_comida"},{title:"Menu",dataIndex:"nombre_menu",key:"nombre_menu"},{title:"Precio",dataIndex:"precio",key:"precio"},{title:"Opcion",render:t=>e.jsxs("div",{className:"flex gap-5",children:[e.jsx("button",{className:"hover:bg-gray-800 rounded-full hover:text-white",onClick:()=>o(t.id_menu_comida,"add",i),children:e.jsx(n.add,{size:25})}),v(t.id_menu_comida)&&e.jsx("button",{className:"hover:bg-gray-800 rounded-full hover:text-white",onClick:()=>o(t.id_menu_comida,"delete",i),children:e.jsx(n.delete,{size:25})})]})}],pagination:{onChange:t=>p(t),pageSize:m,current:y,total:(i==null?void 0:i.length)||0}})]}),e.jsx("div",{children:e.jsxs(I,{layout:"vertical",ref:w,onFinish:P,initialValues:d&&{titular:d.titular,comer_aqui:parseInt(d.comer_aqui),direccion:d.direccion},children:[e.jsx(I.Item,{label:e.jsx("strong",{className:"text-gray-600 text-base block mb-2",children:"Nombre"}),name:"titular",rules:[{required:!0,message:"Ingrese Nombre"}],children:e.jsx(k,{className:"border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200"})}),e.jsx(I.Item,{name:"comer_aqui",rules:[{required:!0,message:"ingrese Opcion"}],children:e.jsxs(E.Group,{className:"flex-center gap-5 mb-4",children:[e.jsx(E,{value:1,children:e.jsx(n.store,{size:30})}),e.jsx(E,{value:0,children:e.jsx(n.truck,{size:30})})]})}),e.jsx(I.Item,{label:e.jsx("strong",{className:"text-gray-600 text-base block mb-2",children:"Dirección"}),name:"direccion",children:e.jsx(k.TextArea,{className:"border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200"})}),e.jsx("strong",{className:"text-gray-400",children:"Seleccionado"}),j.length>0&&e.jsxs("div",{className:"mt-5 p-4 border border-gray-200 rounded-lg shadow-sm bg-gray-50",children:[j.map(t=>e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("strong",{children:t.nombre_menu}),e.jsxs("span",{className:"bg-[#1f2937] text-white py-1 px-2 rounded-md ",children:["x",t.cantidad]})]}),e.jsxs("span",{children:["GTQ ",t.precio*t.cantidad]})]},t.id_menu_comida)),e.jsx("div",{className:"flex justify-end mt-3 bg-gray-100 p-2 rounded-md",children:e.jsxs("strong",{children:["Total: GTQ ",c]})})]}),e.jsx("div",{className:"flex-end mt-2",children:e.jsx(Q,{className:"button-submit",type:"default",htmlType:"submit",children:"Guardar"})})]})})]})})}function Y(){const{loading:d,orden:l,setCarrito:N,getAll:o,calculateTotal:v}=a.useContext(T),[j,c]=a.useState(!1),[i,x]=a.useState(null),[_,y]=a.useState(1),p=5,m=(_-1)*p,C=m+p,[O,w]=a.useState(""),[h,z]=a.useState(null),P=s=>{w(s.target.value)},t=s=>{z(s)},b=l&&l.filter(s=>s.titular.toLowerCase().includes(O.toLowerCase())&&(h===null||parseInt(s.estado)===h)),f=b==null?void 0:b.slice(m,C),q=()=>{x(null),c(!1),N([]),v(0)},A=()=>{c(!1),x(null),o()},L=s=>{N(s.detalle_orden),v(s.detalle_orden),x(s),c(!0)},R=(s,r)=>{K(s,r).then(u=>{u.err?g.error(u.message):g.success(u.message)}).finally(()=>o())},G=(s,r)=>{$(s,r).then(u=>{u.err?g.error(u.message):g.success(u.message)}).finally(()=>o())};return e.jsxs("div",{className:"h-screen px-[5%] py-[5%]",children:[e.jsx("div",{className:"title-1 flex-between",children:e.jsx("span",{children:"ORDENES"})}),e.jsxs("div",{className:"flex-between",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex-center gap-5",children:[e.jsx(n.reload,{size:25,onClick:()=>o(),className:"cursor-pointer"}),e.jsx(k.Search,{onChange:P}),e.jsxs(S,{placeholder:"Filtrar por estado",onChange:t,allowClear:!0,style:{width:200},children:[e.jsx(S.Option,{value:null,children:"Todos"}),e.jsx(S.Option,{value:0,children:"Preparando"}),e.jsx(S.Option,{value:1,children:"Entregado"})]}),e.jsx("button",{onClick:()=>c(!0),children:e.jsx(n.add,{size:25,color:"white",className:"bg-[#1f2937] bg-hover-3 rounded-full"})})]}),e.jsx("div",{})]}),e.jsx(F,{className:"mt-5",dataSource:f,loading:d,rowKey:"id_orden",columns:[{title:"Orden",width:100,render:(s,r)=>e.jsx("div",{className:"bg-4 p-1 mx-auto text-xl text-1 rounded-lg flex-center items-center",children:e.jsx("strong",{children:r.id_orden})}),sorter:(s,r)=>s.id_orden-r.id_orden},{title:"Nombre",width:250,render:(s,r)=>e.jsx("div",{className:"",children:e.jsx("strong",{children:r.titular})})},{title:"Para",render:(s,r)=>e.jsx("div",{className:"",children:e.jsx("strong",{children:parseInt(r.comer_aqui)===1?e.jsx(n.store,{size:30}):e.jsx(n.truck,{size:30})})})},{title:"Fecha",dataIndex:"fecha_ingreso",key:"fecha_ingreso",sorter:(s,r)=>M(s.fecha_ingreso).unix()-M(r.fecha_ingreso).unix()},{title:"Total",render:(s,r)=>e.jsxs("div",{className:"",children:["GTQ ",e.jsx("strong",{children:r.total})]})},{title:"Estado",render:(s,r)=>e.jsx("div",{className:"",children:e.jsx("strong",{className:`${parseInt(r.estado)===1?"bg-green-700 ":"bg-orange-400"} text-white p-1 rounded-md hover:border-2 border-[#00000059] cursor-pointer`,onClick:()=>G(r.id_orden,parseInt(r.estado)===1?0:1),children:parseInt(r.estado)===1?"Entregado":"Preparando"})})},{title:"Pagado",render:(s,r)=>e.jsx("div",{className:"",children:e.jsx("strong",{className:`${parseInt(r.pagado)===1?"text-green-700":"text-red-800"} `,children:e.jsx("div",{className:"cursor-pointer",onClick:()=>R(r.id_orden,parseInt(r.pagado)===1?0:1),children:parseInt(r.pagado)===1?e.jsx(n.check,{size:25}):e.jsx(n.cancel,{size:25})})})})},{title:"Editar",render:(s,r)=>e.jsx("strong",{className:"cursor-pointer",onClick:()=>L(r),children:e.jsx(n.edit,{className:"hover:text-gray-500 ",size:20})})}],pagination:{onChange:s=>y(s),pageSize:p,current:_,total:(l==null?void 0:l.length)||0}}),e.jsx(V,{open:j,footer:null,onCancel:()=>q(),title:e.jsxs("div",{children:[i?"Editar":"Crear"," Orden "]}),width:1200,centered:!0,children:e.jsx(H,{data:i,onClose:()=>A()})})]})}export{Y as default};
